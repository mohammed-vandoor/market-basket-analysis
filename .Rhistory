y<-nchar(as.character(as.integer(price)))
price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
price= if (all(vector(data_error$diffrence)>c(price*.9))){
price*10} else {price}
}
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
View(data_error)
View(data_error)
filterd_data=replace(filterd_data,data_error,by=name_en)
data_error=filterd_data %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
filterd_data=-data_error
data_error=filterd_data %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
filterd_data=-(data_error)
filterd_data=merge(filterd_data,data_error,by=name_en)
filterd_data=merge(filterd_data,data_error,by='name_en')
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data= left_join(filterd_data,data_error,by = NULL, copy = FALSE)
filterd_data= merge(line_product,select_id_order,by='id_order')
data_error=filterd_data %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data= left_join(filterd_data,data_error,by = NULL, copy = FALSE)
View(filterd_data)
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
View(data_error)
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data= left_join(filterd_data,data_error,by = NULL, copy = FALSE)
filterd_data= left_join(filterd_data,data_error,by ='id_order', copy = FALSE)
View(filterd_data)
filterd_data %>% ggplot(aes(unit_price,price.y))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
View(filterd_data)
filterd_data=[match(data_error$id_order,filterd_data$id_order),]
filterd_data<-[match(data_error$id_order,filterd_data$id_order),]
filterd_data <- [match(data_error$id_order,filterd_data$id_order),]
filterd_data <- filterd_data[match(data_error$id_order,filterd_data$id_order),]
View(filterd_data)
filterd_data= merge(line_product,select_id_order,by='id_order')
data_error=filterd_data %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data <- filterd_data[match(data_error$id_order,filterd_data$id_order),]
filterd_data[match(data_error$id_order,filterd_data$id_order),]
filterd_data[match(filterd_data$id_order,data_error$id_order),]
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data[match(filterd_data$id_order,data_error$id_order),]
View(filterd_data)
knitr::opts_chunk$set(echo = TRUE)
data_error=filterd_data %>%select(id_order,name_en,sku,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
data_error=filterd_data %>%select(id_order,name_en,sku,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
data_error=filterd_data %>%select(id_order,name_en,sku,unit_price,price)%>%mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
data_error=filterd_data %>%select(id_order,name_en,sku,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
data_error=filterd_data %>%select(id_order,name_en,sku,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
filterd_data= merge(line_product,select_id_order,by='id_order')
library(RMySQL)
library(DBI)
library(arules)
library(Matrix)
library(dplyr)
library(arulesViz)
library(ggplot2)
library(RMySQL)
library(DBI)
library(arules)
library(Matrix)
library(dplyr)
library(arulesViz)
library(ggplot2)
mydb <-  dbConnect(RMySQL::MySQL(),
username = "root",
password = "rootpassword",
host = "127.0.0.1",
port = 3306,
dbname = "imarket_sql"
)
dbListTables(mydb)
rs = dbSendQuery(mydb, "select * from line_item")
line_item = fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from orders")
orders=fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from products")
products=fetch(rs, n=-1)
dbListTables(mydb)
rs = dbSendQuery(mydb, "select * from line_item")
line_item = fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from orders")
orders=fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from products")
products=fetch(rs, n=-1)
line_item$unit_price = as.numeric(gsub(",",".",line_item$unit_price))
orders$total_paid=as.numeric(gsub(",",".",orders$total_paid))
line_order=merge.data.frame(line_item,orders,by="id_order")
line_order=line_order %>%
filter(state=='Completed')
data_diff =line_order %>%
group_by(id_order) %>%
summarise(sum_products=sum(unit_price*product_quantity), total_paid = mean(total_paid)) %>%
mutate(differance =(sum_products - total_paid))
data_diff %>% ggplot(aes(sum_products,total_paid))+geom_point()+geom_abline()
select_id_order = data_diff %>% filter(differance<=sum_products*.7,differance>=-sum_products*.6)
select_id_order %>% ggplot(aes(sum_products,total_paid))+geom_point()+geom_abline()
line_product=merge(line_item,products,by="sku")
line_product=merge(line_item,products,by="sku")
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data %>% ggplot(aes(unit_price,price))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(!(diffrence>unit_price,diffrence>(as.numeric(price)*.95)))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(!diffrence>unit_price,diffrence>(as.numeric(price)*.95))
View(remaining)
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(!(diffrence>unit_price,diffrence>(as.numeric(price)*.95)))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price!&diffrence>(as.numeric(price)*.95)))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>unit_price,diffrence>(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>unit_price & diffrence>(as.numeric(price)*.95)))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
View(remaining)
filterd_data=full_join(data_error,remaining)
View(filterd_data)
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data=full_join(data_error,remaining)
filterd_data=full_join(data_error,remaining,by='id_order')
View(filterd_data)
filterd_data=join(data_error,remaining,by='id_order')
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
filterd_data= merge(line_product,select_id_order,by='id_order')
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data=join(data_error,remaining,by='id_order')
filterd_data=full_join(data_error,remaining)
filterd_data=data_error+remaining
filterd_data=rbind(data_error,remaining)
filterd_data=rbind(data_error,remaining)
View(filterd_data)
filterd_data %>% ggplot(aes(unit_price,price.y))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
filterd_data %>% ggplot(aes(unit_price,price))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
View(filterd_data)
filterd_data %>% ggplot(aes(unit_price,price))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
filterd_data1=rbind(data_error,remaining)
filterd_data1=rbind(data_error,remaining)
filterd_data1=rbind(data_error,remaining)
filterd_data1 %>% ggplot(aes(unit_price,price))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
filterd_data1 %>% ggplot(aes(unit_price,price))+geom_jitter()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data %>% ggplot(aes(unit_price,price))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
View(remaining)
filterd_data %>% mutate (diff=price-unit_price) %>% ggplot(aes(unit_price,price))+geom_point()+scale_y_discrete(name ='price', breaks=c(2000,4000,6000,8000))
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
filterd_data %>%  ggplot(aes(unit_price,diffrence))+geom_point()
filterd_data %>%  ggplot(aes(unit_price,price),fill=differance)+geom_point()
filterd_data %>%  ggplot(aes(unit_price,price),fill=diffrence)+geom_point()
filterd_data %>%  ggplot(aes(unit_price,price),color=diffrence)+geom_point()
filterd_data %>%  ggplot(aes(unit_price,price))+geom_point()
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data1=rbind(data_error,remaining)
filterd_data1 %>% ggplot(aes(unit_price,price))+geom_jitter()+scale_y_discrete(name ='price', breaks=NULL)
filterd_data %>%  ggplot(aes(unit_price,price))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
View(filterd_data)
View(filterd_data)
View(filterd_data1)
View(filterd_data1)
filterd_data %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
filterd_data %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
filterd_data1 %>% ggplot(aes(unit_price,diffrence))+geom_jitter()+scale_y_discrete(name ='price', breaks=NULL)
filterd_data1 %>% ggplot(aes(unit_price,price))+geom_jitter()+scale_y_discrete(name ='price', breaks=NULL)
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
data_error %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
data_error %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
line_product=merge(line_item,products,by="sku")
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
data_error %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
data_error %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
filterd_data1=rbind(data_error,remaining)
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
data_error %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
filterd_data1=rbind(data_error,remaining)
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*price)
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*as.numeric(price))
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
data_diff2=filterd_data %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*as.numeric(price))
line_product=merge(line_item,products,by="sku")
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*as.numeric(price))
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*as.numeric(price))
View(data_diff)
line_product=merge(line_item,products,by="sku")
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
library(RMySQL)
library(DBI)
library(arules)
library(Matrix)
library(dplyr)
library(arulesViz)
library(ggplot2)
mydb <-  dbConnect(RMySQL::MySQL(),
username = "root",
password = "rootpassword",
host = "127.0.0.1",
port = 3306,
dbname = "imarket_sql"
)
dbListTables(mydb)
rs = dbSendQuery(mydb, "select * from line_item")
line_item = fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from orders")
orders=fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from products")
products=fetch(rs, n=-1)
line_item$unit_price = as.numeric(gsub(",",".",line_item$unit_price))
orders$total_paid=as.numeric(gsub(",",".",orders$total_paid))
line_order=merge.data.frame(line_item,orders,by="id_order")
line_order=line_order %>%
filter(state=='Completed')
data_diff =line_order %>%
group_by(id_order) %>%
summarise(sum_products=sum(unit_price*product_quantity), total_paid = mean(total_paid)) %>%
mutate(differance =(sum_products - total_paid))
select_id_order = data_diff %>% filter(differance<=sum_products*.7,differance>=-sum_products*.6)
line_product=merge(line_item,products,by="sku")
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
data_error %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data1=rbind(data_error,remaining)
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*as.numeric(price))
write.csv(data_diff2,file ="filterd_dataset" )
modal_set<-read.transactions(file = "filterd_dataset",format = c("single"),
header=TRUE,sep = ",",cols = c("data_diff2.id_order","data_diff2.name_en."))
setwd("~/ubiqum/module_2/sprint_4")
write.csv(data_diff2,file ="filterd_dataset" )
modal_set<-read.transactions(file = "filterd_dataset",format = c("single"),
header=TRUE,sep = ",",cols = c("data_diff2.id_order","data_diff2.name_en."))
modal_set<-read.transactions(file = "filterd_dataset",format = c("single"),
header=TRUE,sep = ",",cols = c("id_order","name_en."))
modal_set<-read.transactions(file = "filterd_dataset",format = c("single"),
header=TRUE,sep = ",",cols = c("id_order","name_en"))
View(modal_set)
table(size(modal_set))
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=(.75*(as.numeric(price))))
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*as.numeric(price))
library(RMySQL)
library(DBI)
library(arules)
library(Matrix)
library(dplyr)
library(arulesViz)
mydb <-  dbConnect(RMySQL::MySQL(),
username = "root",
password = "rootpassword",
host = "127.0.0.1",
port = 3306,
dbname = "imarket_sql"
)
dbListTables(mydb)
dbListFields(mydb, 'line_item')
rs = dbSendQuery(mydb, "select * from line_item")
line_item = fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from orders")
orders=fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from products")
products=fetch(rs, n=-1)
line_order=merge.data.frame(line_item,orders,by="id_order")
line_order=line_order %>%
filter(state=='Completed')
line_order_product=merge(line_order,products,by="sku")
line_order_product <- line_order_product %>%
mutate(unit_price = as.numeric(gsub(",",".",unit_price)))
line_order_product$total_paid=as.numeric(gsub(",",".",line_order_product$total_paid))
line_order_product$price=as.numeric(gsub(",",".",line_order_product$price))
data1=line_order_product %>%
group_by(id_order,total_paid,price,product_quantity,unit_price,sku) %>%
summarise(sum=sum(unit_price*product_quantity)) %>%
mutate(differance=abs(total_paid-sum)) %>%
filter(differance<=sum*.75)
id=data.frame(data1$id_order)
line_order_product=line_order_product %>%
inner_join (line_order_product,id,by='id_order')
data2=line_order_product %>%select(id_order,name_en.x,unit_price.x,price.x,product_quantity.x)%>%
mutate(diffrence=abs(price.x-unit_price.x)) %>%  filter(diffrence <= (unit_price.x)*.5)
data3=data.frame(data2$id_order,data2$name_en.x)
write.csv(data3,file ="filterd_dataset" )
modal_set<-read.transactions(file = "filterd_dataset",format = c("single"),
header=TRUE,sep = ",",cols = c("data2.id_order","data2.name_en.x"))
View(modal_set)
inspect(modal_set)
length(modal_set)
table(size(modal_set))
LIST(modal_set)
itemLabels(modal_set)
table(size(modal_set))
RulesName <- apriori (modal_set, parameter = list(supp = 0.000270144 , conf = 0.19,minlen=2))
table(size(modal_set))
summary(modal_set)
library(RMySQL)
library(DBI)
library(arules)
library(Matrix)
library(dplyr)
library(arulesViz)
library(ggplot2)
mydb <-  dbConnect(RMySQL::MySQL(),
username = "root",
password = "rootpassword",
host = "127.0.0.1",
port = 3306,
dbname = "imarket_sql"
)
dbListTables(mydb)
rs = dbSendQuery(mydb, "select * from line_item")
line_item = fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from orders")
orders=fetch(rs, n=-1)
rs = dbSendQuery(mydb, "select * from products")
products=fetch(rs, n=-1)
line_item$unit_price = as.numeric(gsub(",",".",line_item$unit_price))
orders$total_paid=as.numeric(gsub(",",".",orders$total_paid))
line_order=merge.data.frame(line_item,orders,by="id_order")
line_order=line_order %>%
filter(state=='Completed')
data_diff =line_order %>%
group_by(id_order) %>%
summarise(sum_products=sum(unit_price*product_quantity), total_paid = mean(total_paid)) %>%
mutate(differance =(sum_products - total_paid))
select_id_order = data_diff %>% filter(differance<=sum_products*.7,differance>=-sum_products*.6)
line_product=merge(line_item,products,by="sku")
filterd_data= merge(line_product,select_id_order,by='id_order')
filterd_data=filterd_data %>% mutate(diffrence=abs(as.numeric(price)-unit_price))
filterd_data %>%  ggplot(aes(unit_price,diffrence))+geom_point()+scale_y_discrete(name ='price', breaks=NULL)
data_error=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence>=unit_price,diffrence>=(as.numeric(price)*.95))
remaining=filterd_data %>% select(id_order,name_en,sku,unit_price,price) %>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>%
filter(!(diffrence>=unit_price & diffrence>=(as.numeric(price)*.95)))
for (row in 1:nrow(data_error)) {
price <- as.numeric(data_error$price)
unit_price  <-as.numeric( data_error$unit_price)
x<-nchar(as.character(as.integer(unit_price)))
y<-nchar(as.character(as.integer(price)))
data_error$price=(price/10^(y-x))
data_error$diffrence=abs(price-unit_price)
}
filterd_data1=rbind(data_error,remaining)
filterd_data1 %>% ggplot(aes(unit_price,price))+geom_jitter()+scale_y_discrete(name ='price', breaks=NULL)
write.csv(data_diff2,file ="filterd_dataset" )
data_diff2=filterd_data1 %>%select(id_order,name_en,unit_price,price)%>%
mutate(diffrence=abs(as.numeric(price)-unit_price)) %>% filter(diffrence<=.75*as.numeric(price))
write.csv(data_diff2,file ="filterd_dataset" )
modal_set<-read.transactions(file = "filterd_dataset",format = c("single"),
header=TRUE,sep = ",",cols = c("id_order","name_en"))
modal_set<-read.transactions(file = "filterd_dataset",format = c("single"),
header=TRUE,sep = ",",cols = c("id_order","name_en"))
table(size(modal_set))
summary(modal_set)
RulesName <- apriori (modal_set, parameter = list(supp = 0.0002257014  , conf = 0.19,minlen=2))
RulesName <- apriori (modal_set, parameter = list(supp = 0.0002257014  , conf = 0.2,minlen=2))
RulesName <- apriori (modal_set, parameter = list(supp = 0.0002257014  , conf = 0.25,minlen=2))
top10subRules <- head(RulesName, n = 10, by = "confidence")
plot(top10subRules, method = "graph",  engine = "htmlwidget")
